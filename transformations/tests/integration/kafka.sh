#!/bin/bash

# This script runs inside the kafka container

DOCKER_KAFKA="docker-compose exec -u $(id -u):$(id -g) -T kafka "
KAFKA_TOPIC="$DOCKER_KAFKA /usr/bin/kafka-topics"
KAFKA_CONSOLE_CONSUMER="$DOCKER_KAFKA /usr/bin/kafka-console-consumer"
KAFKA_CONSOLE_PRODUCER="$DOCKER_KAFKA /usr/bin/kafka-console-producer"
KAFKA_BROKER=kafka:9092


# TODO: move this function to a file mounted as docker volume
create_order_file(){
    local file=$1

    cat > $file <<'_EOF'
dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f: {"cpf":"80532101763","customer_id":"977b9a89-825f-464b-8ef6-0f453d7334c1","customer_name":"GUSTAVO","delivery_address_city":"FRANCA","delivery_address_country":"BR","delivery_address_district":"JARDIM ESPRAIADO","delivery_address_external_id":"6736655","delivery_address_latitude":"-47.39","delivery_address_longitude":"-20.55","delivery_address_state":"SP","delivery_address_zip_code":"14403","items":"[{\"name\": \"Parmegiana de Filé de Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"externalId\": \"0bcd6764fd5e466d9c04b18ac0eb69e6\", \"totalValue\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"COM Arroz branco\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"13HDH\", \"externalId\": \"384bd2b4eb7d454d8e0274e7d590ab4f\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"PERSONALIZAR\", \"integrationId\": null}], \"integrationId\": \"PMFR\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"Lasanha Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"externalId\": \"a361f5eec6a44ac0817892e81bf22e80\", \"totalValue\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": \"LF\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"eb4197f9-964c-4f87-8307-709e498aab87","merchant_latitude":"-47.39","merchant_longitude":"-20.55","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T22:50:06.000Z","order_id":"dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f","order_scheduled":false,"order_total_amount":46.0,"origin_platform":"ANDROID"}
8dd80f0b-db00-4b88-b7e2-02ca706fc5a5: {"cpf":"43352103961","customer_id":"e969cc0d-388b-4025-9351-0db0f718d81c","customer_name":"MICHELLE","delivery_address_city":"SANTOS","delivery_address_country":"BR","delivery_address_district":"CAMPO GRANDE","delivery_address_external_id":"8759216","delivery_address_latitude":"-46.34","delivery_address_longitude":"-23.96","delivery_address_state":"SP","delivery_address_zip_code":"11070","items":"[{\"name\": \"Filé Mignon à Cubana\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"e0e81b2027c241cca5bf60a4768800ec\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"334 - 1/2 porção \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"7350\", \"currency\": \"BRL\"}, \"categoryId\": \"1J3T0\", \"externalId\": \"b869c10747d1417d8968d7e3e1bd7de4\", \"totalValue\": {\"value\": \"7350\", \"currency\": \"BRL\"}, \"categoryName\": \"escolha sua porção \", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"603- Pudim de leite\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"externalId\": \"4436f76edc164052aaf3c21a6567b570\", \"totalValue\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"601-Torta Holandesa\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 5, \"unitPrice\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"externalId\": \"c0b788e876c54f198307dc142fed7aff\", \"totalValue\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"513 - Guarnição Completa II\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1500\", \"currency\": \"BRL\"}, \"externalId\": \"385fb04a358340878b14116df9970e46\", \"totalValue\": {\"value\": \"1500\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"927d46f9-4bb3-48f7-be1d-584deaf18adc","merchant_latitude":"-46.34","merchant_longitude":"-23.96","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T17:51:26.000Z","order_id":"8dd80f0b-db00-4b88-b7e2-02ca706fc5a5","order_scheduled":false,"order_total_amount":104.5,"origin_platform":"ANDROID"}
430f9887-a563-45ee-8001-1cb29597d9dd: {"cpf":"38650991217","customer_id":"e08dcc8b-f998-405e-b3f2-7107ea8958cf","customer_name":"VICTOR","delivery_address_city":"GUARULHOS","delivery_address_country":"BR","delivery_address_district":"JARDIM ROSSI","delivery_address_external_id":"8765930","delivery_address_latitude":"-46.53","delivery_address_longitude":"-23.44","delivery_address_state":"SP","delivery_address_zip_code":"71304","items":"[{\"name\": \"GRANDE 2 SABORES\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"87a24efdd88c4b7b8bf1132cabfd4195\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"TRADICIONAL\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"0025\", \"externalId\": \"2b89a4d4d6f14541a8830e5808d1f09f\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha a sua Preferência\", \"integrationId\": null}, {\"name\": \"1/2 21 - PIZZA FRANGO COM BACON E CATUPIRY \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"c7f63cc58a3643c7aa3f24858c7029f4\", \"totalValue\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 21 - PIZZA FRANGO COM BACON E CATUPIRY \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"c7f63cc58a3643c7aa3f24858c7029f4\", \"totalValue\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}, {\"name\": \"1/2 29 - PIZZA À MODA DA CASA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"0dcd4a195d6243ec806eb5a29682c797\", \"totalValue\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 29 - PIZZA À MODA DA CASA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"0dcd4a195d6243ec806eb5a29682c797\", \"totalValue\": {\"value\": \"1750\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"71ad62c5-5947-4518-9846-976fbdd2f881","merchant_latitude":"-46.53","merchant_longitude":"-23.44","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T22:53:47.000Z","order_id":"430f9887-a563-45ee-8001-1cb29597d9dd","order_scheduled":false,"order_total_amount":35.0,"origin_platform":"IOS"}
1294917e-2247-4891-a183-4a4d4a3fa356: {"cpf":"63579726866","customer_id":"6b40a7cc-de6a-4456-ada3-66d67453b88e","customer_name":"ANNIE","delivery_address_city":"SAO PAULO","delivery_address_country":"BR","delivery_address_district":"PARQUE SAO JORGE","delivery_address_external_id":"7834087","delivery_address_latitude":"-46.57","delivery_address_longitude":"-23.53","delivery_address_state":"SP","delivery_address_zip_code":"30870","items":"[{\"name\": \"CALABRESA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2040\", \"currency\": \"BRL\"}, \"externalId\": \"5b598957c69a4aa68e02a20e3ce617a1\", \"totalValue\": {\"value\": \"2040\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"CHEESE SALADA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"2040\", \"currency\": \"BRL\"}, \"externalId\": \"3a64b961d342467ea23792556c99f7c2\", \"totalValue\": {\"value\": \"2040\", \"currency\": \"BRL\"}, \"customerNote\": \"Sem tomate\", \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"27d71c8f-fa45-41a6-a964-dc8aefbd4540","merchant_latitude":"-46.57","merchant_longitude":"-23.53","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T23:56:53.000Z","order_id":"1294917e-2247-4891-a183-4a4d4a3fa356","order_scheduled":false,"order_total_amount":40.8,"origin_platform":"IOS"}
34755d74-781a-461b-8564-45a4e8d99dbd: {"cpf":"90617788806","customer_id":"647469d8-e0f8-4fce-8fa9-eafd1802ccf1","customer_name":"DANIEL","delivery_address_city":"VITORIA","delivery_address_country":"BR","delivery_address_district":"JARDIM CAMBURI","delivery_address_external_id":"7211683","delivery_address_latitude":"-40.27","delivery_address_longitude":"-20.25","delivery_address_state":"ES","delivery_address_zip_code":"29090","items":"[{\"name\": \"GRANDE (35CM) 8 PDÇ 2 SABORES\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"83127d50665f4a269febd427eb49306b\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"BORDA CATUPIRY GRÁTIS \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"0025\", \"externalId\": \"e9a71c078a6045eabb09bd4d38b991c6\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha a sua Preferência\", \"integrationId\": null}, {\"name\": \"1/2 MISTA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"46510932dfd448af910ae16e112a8d3a\", \"totalValue\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 MISTA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"46510932dfd448af910ae16e112a8d3a\", \"totalValue\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}, {\"name\": \"1/2 À MODA CAPIXABA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"5be89603526f4c42a6d9ac9e05f8a19a\", \"totalValue\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 À MODA CAPIXABA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"5be89603526f4c42a6d9ac9e05f8a19a\", \"totalValue\": {\"value\": \"2425\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"06764c46-8a87-490e-9b8d-e9310d0d6822","merchant_latitude":"-40.27","merchant_longitude":"-20.25","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T23:40:53.000Z","order_id":"34755d74-781a-461b-8564-45a4e8d99dbd","order_scheduled":false,"order_total_amount":48.5,"origin_platform":"ANDROID"}
cdeeb2c8-75d7-486e-bca7-5c89d5c0b922: {"cpf":"49736666572","customer_id":"2619d4eb-89cd-4903-8be7-fb41cf3bd42e","customer_name":"ANDRE","delivery_address_city":"SAO PAULO","delivery_address_country":"BR","delivery_address_district":"JARDIM PAULISTA","delivery_address_external_id":"1989863","delivery_address_latitude":"-46.66","delivery_address_longitude":"-23.57","delivery_address_state":"SP","delivery_address_zip_code":"14280","items":"[{\"name\": \"GRANDE 2 SABORES\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"7d574da42a5049d985813e5386374d8f\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"MASSA TRADICIONAL\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"0025\", \"externalId\": \"9673073baef2497094d5394f6e6fb1e0\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha a sua Preferência\", \"integrationId\": null}, {\"name\": \"1/2 MARGHERITA\", \"addition\": {\"value\": \"450\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"2950\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"3ad791d57d3a4923889b5c25a233af4e\", \"totalValue\": {\"value\": \"2950\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 MARGHERITA\", \"addition\": {\"value\": \"450\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"2950\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"3ad791d57d3a4923889b5c25a233af4e\", \"totalValue\": {\"value\": \"2950\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}, {\"name\": \"1/2 DELLA NONNA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"3400\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"ea110a2c24cd48c4b26a2688e90c724b\", \"totalValue\": {\"value\": \"3400\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 DELLA NONNA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"3400\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"ea110a2c24cd48c4b26a2688e90c724b\", \"totalValue\": {\"value\": \"3400\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"Guaraná Antarctica Zero (2 litros)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 5, \"unitPrice\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"externalId\": \"23fc81b0447f45d2b8eb583ff4e63a7c\", \"totalValue\": {\"value\": \"1600\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"65f84e1b-90ec-4753-8cb0-a6330539cc38","merchant_latitude":"-46.66","merchant_longitude":"-23.57","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T23:54:27.000Z","order_id":"cdeeb2c8-75d7-486e-bca7-5c89d5c0b922","order_scheduled":false,"order_total_amount":84.0,"origin_platform":"IOS"}
12933124-f673-4efa-a871-179be94b370b: {"cpf":"75685211474","customer_id":"c876e84b-41c0-42e7-ab20-af8be452c241","customer_name":"PRISCILLA","delivery_address_city":"RIO DE JANEIRO","delivery_address_country":"BR","delivery_address_district":"MADUREIRA","delivery_address_external_id":"4021471","delivery_address_latitude":"-43.33","delivery_address_longitude":"-22.86","delivery_address_state":"RJ","delivery_address_zip_code":"21360","items":"[{\"name\": \"Açaí\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"17cd2c74c83b4bcabfc6efdbc57fa95a\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"500ml\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"categoryId\": \"1F7Q3\", \"externalId\": \"de3350eb76974e65b54661a0aa0e085e\", \"totalValue\": {\"value\": \"1600\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o tamanho\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"876fd7cf-1bf9-46b6-91fe-237161cedf24","merchant_latitude":"-43.33","merchant_longitude":"-22.86","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T21:47:53.000Z","order_id":"12933124-f673-4efa-a871-179be94b370b","order_scheduled":false,"order_total_amount":16.0,"origin_platform":"ANDROID"}
3c659e61-4213-4719-a297-2d291e43ea82: {"cpf":"23526017552","customer_id":"ecc76f6a-d0db-4b25-ac06-b6e5021b986a","customer_name":"BRUNO","delivery_address_city":"SAO PAULO","delivery_address_country":"BR","delivery_address_district":"PLANALTO PAULISTA","delivery_address_external_id":"2837671","delivery_address_latitude":"-46.64","delivery_address_longitude":"-23.62","delivery_address_state":"SP","delivery_address_zip_code":"40690","items":"[{\"name\": \"ROLINHO DE CHOCOLATE COM BANANA\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"1100\", \"currency\": \"BRL\"}, \"externalId\": \"3945ac1715f04b41921bcac369aa7c0e\", \"totalValue\": {\"value\": \"1100\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"YAKISOBA DE VEGETAIS GRANDE\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"3290\", \"currency\": \"BRL\"}, \"externalId\": \"376c4f2bede84056aa2bbbb950205740\", \"totalValue\": {\"value\": \"3290\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"a67b9d0b-d828-4066-b556-e7992b87713e","merchant_latitude":"-46.64","merchant_longitude":"-23.62","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T23:25:59.000Z","order_id":"3c659e61-4213-4719-a297-2d291e43ea82","order_scheduled":false,"order_total_amount":43.9,"origin_platform":"IOS"}
fa058a2f-11a2-4091-af88-940b62eae8f2: {"cpf":"06823673386","customer_id":"ccd69500-6480-4c8b-aaa2-d6a1f969cb51","customer_name":"EDUARDO","delivery_address_city":"FORTALEZA","delivery_address_country":"BR","delivery_address_district":"MEIRELES","delivery_address_external_id":"2972297","delivery_address_latitude":"-38.50","delivery_address_longitude":"-3.73","delivery_address_state":"CE","delivery_address_zip_code":"60125","items":"[{\"name\": \"GRANDE  2 SABORES\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"2000120b9516407e9c9629d5a9194012\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"MASSA TRADICIONAL \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"0025\", \"externalId\": \"e7aaed15e7c24149b8fae6c022e3f4a9\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha a sua Preferência\", \"integrationId\": null}, {\"name\": \"1/2 093 - SICILIANA \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"f85302e3bf704368a592d1f6deeb5eae\", \"totalValue\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 093 - SICILIANA \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"f85302e3bf704368a592d1f6deeb5eae\", \"totalValue\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}, {\"name\": \"1/2 323 - PORTUGUESA \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR\", \"externalId\": \"7dc03eeaaea84b29be4fff1833e45c96\", \"totalValue\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um sabor\", \"integrationId\": null}, {\"name\": \"1/2 323 - PORTUGUESA \", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryId\": \"SABOR2\", \"externalId\": \"7dc03eeaaea84b29be4fff1833e45c96\", \"totalValue\": {\"value\": \"1795\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha o segundo sabor\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"6e8d67a9-d00c-4e87-ae92-62b26ea54ad9","merchant_latitude":"-38.50","merchant_longitude":"-3.73","merchant_timezone":"America/Fortaleza","order_created_at":"2019-01-17T22:28:09.000Z","order_id":"fa058a2f-11a2-4091-af88-940b62eae8f2","order_scheduled":false,"order_total_amount":35.9,"origin_platform":"IOS"}
8bda711e-11af-4607-b70b-04828875cb05: {"cpf":"79719037778","customer_id":"6ee39c63-7963-4002-b84a-e2ad6f94ac8f","customer_name":"Amanda","delivery_address_city":"RIO DE JANEIRO","delivery_address_country":"BR","delivery_address_district":"QUINTINO BOCAIUVA","delivery_address_external_id":"2938122","delivery_address_latitude":"-43.32","delivery_address_longitude":"-22.89","delivery_address_state":"RJ","delivery_address_zip_code":"21380","items":"[{\"name\": \"Açaí\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"externalId\": \"2acdc33845c741d38b509f1402058c4b\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"customerNote\": \"2 granolas separadas por favor0\", \"garnishItems\": [{\"name\": \"500 ml\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 4, \"unitPrice\": {\"value\": \"800\", \"currency\": \"BRL\"}, \"categoryId\": \"16VIL\", \"externalId\": \"874be3115dee4b8395c5b26e74e531f2\", \"totalValue\": {\"value\": \"1600\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha um Tamanho\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"TRIO - Número 1\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"1600\", \"currency\": \"BRL\"}, \"externalId\": \"771f96d99dc1472caaa8a26f2b94e906\", \"totalValue\": {\"value\": \"1600\", \"currency\": \"BRL\"}, \"customerNote\": \" \", \"garnishItems\": [{\"name\": \"Fanta Laranja Lata\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"18XKL\", \"externalId\": \"61d7db2af042492cac5e759ed2a45c2d\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha sua preferencia\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"Trio - Cheddar\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 5, \"unitPrice\": {\"value\": \"1400\", \"currency\": \"BRL\"}, \"externalId\": \"1c30a29f8a254761a52e977205a52b23\", \"totalValue\": {\"value\": \"1400\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"Coca- cola Zero Lata\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 6, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"18XKJ\", \"externalId\": \"c6cde92441aa47808ecfeff1dd4d8610\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Escolha sua preferencia\", \"integrationId\": null}], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]","merchant_id":"db9a0f10-535d-4813-8337-ac12e4b0c5df","merchant_latitude":"-43.32","merchant_longitude":"-22.89","merchant_timezone":"America/Sao_Paulo","order_created_at":"2019-01-17T22:49:28.000Z","order_id":"8bda711e-11af-4607-b70b-04828875cb05","order_scheduled":false,"order_total_amount":46.0,"origin_platform":"ANDROID"}
_EOF
}

kafka_create_topic(){
  local topic=$1

  echo "Kafka: creating topic $topic"
  $KAFKA_TOPIC --bootstrap-server $KAFKA_BROKER \
               --create --topic $topic \
               --replication-factor 1 \
               --partitions 1
  $KAFKA_TOPIC --bootstrap-server $KAFKA_BROKER --list | grep -v "_"
}

kafka_produce_topic(){
  local topic=$1
  local file=$2

  cat $file | $KAFKA_CONSOLE_PRODUCER \
    --broker-list $KAFKA_BROKER \
    --topic $topic \
    --property "parse.key=true" \
    --property "key.separator=:"
}

kafka_consume_topic(){
  local topic=$1
  local total_lines=$2
  local key=$3

  echo $($KAFKA_CONSOLE_CONSUMER \
    --bootstrap-server $KAFKA_BROKER \
    --topic $topic \
    --from-beginning \
    --max-messages $total_lines | grep $key)
}

kafka_count_number_of_messages(){
  local topic=$1
  local total_lines=$2
  local key=$3

  echo $($KAFKA_CONSOLE_CONSUMER \
    --bootstrap-server $KAFKA_BROKER \
    --topic $topic \
    --from-beginning \
    --max-messages $total_lines | grep $key | wc -l)
}
